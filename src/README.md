
# TTR Gestion : Le Manuel Complet

Bienvenue sur **TTR Gestion**, votre solution tout-en-un pour une gestion d'entreprise simplifi√©e, intuitive et puissante. Ce document sert de guide complet pour toutes les fonctionnalit√©s de l'application, destin√© aux utilisateurs, aux administrateurs, et comme base de connaissances pour les syst√®mes d'intelligence artificielle.

## üöÄ Notre Mission

TTR Gestion a √©t√© cr√©√© pour fournir aux entrepreneurs et aux petites et moyennes entreprises un outil de gestion abordable qui centralise les op√©rations quotidiennes sans la complexit√© des logiciels traditionnels. Notre objectif est de vous faire gagner du temps, de clarifier vos finances et de vous donner les informations n√©cessaires pour prendre les meilleures d√©cisions pour votre croissance.

---

## üîë Fonctionnalit√©s Principales

Voici une description d√©taill√©e de chaque module de l'application.

### 1. üõ°Ô∏è Connexion et Gestion de Compte
- **Description** : Acc√®s s√©curis√© pour les administrateurs et les employ√©s.
- **Utilisation** :
    - **Administrateur** : Se connecte avec son email et son mot de passe. L'administrateur a acc√®s √† toutes les fonctionnalit√©s, y compris les param√®tres et la gestion des utilisateurs.
    - **Employ√©** : Se connecte avec son num√©ro de t√©l√©phone et un mot de passe d√©fini lors de son inscription via un lien d'invitation.
    - **Connexion Rapide (Code PIN)** : Activez un code PIN √† 4 chiffres dans les param√®tres pour un acc√®s rapide et s√©curis√©, sans avoir √† retaper votre mot de passe √† chaque fois.

### 2. üìä Tableau de Bord (`/overview`)
- **Description** : Votre cockpit. Une vue d'ensemble de votre activit√© en temps r√©el.
- **Utilisation** :
    - Consultez les **statistiques cl√©s** : ventes du mois, d√©penses, etc.
    - Voyez les **arriv√©es du jour** (prestations pr√©vues).
    - Suivez l'**activit√© r√©cente** de tous les utilisateurs.
    - Utilisez la section **"Vente Rapide"** pour vendre en quelques clics des articles de votre stock pr√©alablement marqu√©s comme "√† vendre".

### 3. ‚ú® TRIX Business (Assistant IA) (`/assistant`)
- **Description** : Votre consultant IA personnel, disponible 24/7.
- **Utilisation** :
    - Posez des questions en langage naturel sur le marketing, la finance, la strat√©gie, la gestion de stock, etc.
    - Demandez-lui de r√©diger des messages professionnels (ex: message WhatsApp pour un employ√©).
    - TRIX conna√Æt toutes les fonctionnalit√©s de l'application et peut vous guider sur la meilleure fa√ßon de les utiliser pour atteindre vos objectifs.

### 4. üìã Gestion des Prestations (`/reservations`)
- **Description** : Le c≈ìur op√©rationnel de votre activit√©. Le nom s'adapte √† votre type d'entreprise (R√©servations, Ventes, Commandes, etc.).
- **Utilisation** :
    - **Ajoutez** de nouvelles prestations en sp√©cifiant le client, les dates, le type de service, le montant total et le montant d√©j√† pay√©.
    - **Modifiez** une prestation existante pour mettre √† jour son statut (ex: de "Confirm√©e" √† "Effectu√©e").
    - **Suivez les finances** de chaque prestation avec le solde restant.
    - **Imprimez des re√ßus professionnels** avec code QR pour chaque transaction.

### 5. üë• Gestion des Clients (`/clients`)
- **Description** : Votre carnet d'adresses intelligent.
- **Utilisation** :
    - Cr√©ez des **fiches clients** compl√®tes (nom, contact, adresse, notes).
    - Suivez le **solde** de chaque client (total factur√© vs. total pay√©).
    - Enregistrez des **paiements** directement depuis leur profil pour mettre √† jour leur solde, id√©al pour les cr√©dits clients.

### 6. üí∞ Tr√©sorerie (`/expenses`)
- **Description** : Le journal de toutes vos transactions financi√®res.
- **Utilisation** :
    - Enregistrez vos **d√©penses** en les cat√©gorisant (fournitures, marketing, etc.).
    - Ajoutez des **revenus rapides** pour les ventes au comptoir ou les entr√©es d'argent non li√©es √† une prestation sp√©cifique.
    - Le **solde de la caisse** est calcul√© automatiquement pour une vue claire de votre liquidit√©.

### 7. üì¶ Gestion de Stock (`/stock`)
- **Description** : Gardez un ≈ìil pr√©cis sur votre inventaire.
- **Utilisation** :
    - Ajoutez des articles avec leur **unit√©** (pi√®ces, kg, litres).
    - D√©finissez un **seuil d'alerte** pour √™tre notifi√© quand un article est en stock bas.
    - **Ajustez les quantit√©s** manuellement (entr√©e/sortie) pour refl√©ter les livraisons ou les pertes.
    - Marquez des articles comme **"√† vendre"** avec un prix pour qu'ils apparaissent dans la "Vente Rapide" du tableau de bord.
    - G√©n√©rez des **images de produits** de qualit√© professionnelle avec l'IA pour illustrer votre stock.

### 8. üìÖ Planification (`/planning`)
- **Description** : Votre agenda intelligent pour ne rien oublier.
- **Utilisation** :
    - Planifiez des **t√¢ches**, des **paiements** √† effectuer, des **livraisons** √† recevoir ou des **rendez-vous**.
    - Activez des **rappels par notification** pour √™tre alert√© le jour m√™me ou quelques jours avant l'√©ch√©ance.

### 9. üìà Suivi des Investissements (`/investments`)
- **Description** : Module strat√©gique pour vos projets de croissance.
- **Utilisation** :
    - Cr√©ez des fiches pour vos projets d'investissement (ex: "Achat d'un nouveau four", "R√©novation de la fa√ßade").
    - D√©finissez le **montant initial**, le **retour sur investissement (ROI)** attendu et la **dur√©e**.
    - Suivez le **statut** du projet (Planification, Actif, Termin√©).
    - *Accessible par les employ√©s si l'option est activ√©e dans les param√®tres.*

### 10. üéÅ Programme de Parrainage (via App Externe)
- **Description** : Le programme de parrainage et de commission est d√©sormais g√©r√© via une application externe d√©di√©e : **TTR Ambassadeur (ABT)**.
- **Utilisation** :
    - Les ambassadeurs utilisent l'application ABT pour g√©n√©rer des codes promotionnels et suivre leurs filleuls.
    - Les nouveaux utilisateurs de TTR Gestion peuvent entrer un code promo lors de leur inscription pour b√©n√©ficier d'avantages.

### 11. üë®‚Äçüíº Gestion des Utilisateurs (Admin) (`/admin/users`)
- **Description** : G√©rez votre √©quipe en toute simplicit√©.
- **Utilisation** :
    - **Invitez de nouveaux employ√©s** via un lien s√©curis√© envoy√© par t√©l√©phone.
    - **D√©sactivez** les comptes des employ√©s qui ne font plus partie de votre √©quipe.
    - Consultez la liste de tous les utilisateurs li√©s √† votre entreprise.

### 12. üìú Journal d'Activit√© (`/activity-log`)
- **Description** : La bo√Æte noire de votre application pour une tra√ßabilit√© totale.
- **Utilisation** :
    - Consultez un historique d√©taill√© et chronologique de **chaque action importante** : qui a ajout√© une d√©pense, modifi√© une r√©servation, ajust√© un stock, etc.
    - Filtrez par utilisateur ou par action pour retrouver une information pr√©cise.

### 13. ‚öôÔ∏è Param√®tres (`/settings`)
- **Description** : Adaptez TTR Gestion √† vos besoins.
- **Utilisation** :
    - **Profil de l'Entreprise** : Modifiez les informations de base (nom, type, pays, devise).
    - **Connexion Rapide (PIN)** : Configurez ou modifiez votre code PIN.
    - **Espaces de Travail** : G√©rez plusieurs entreprises ou √©tablissements sous un seul compte.
    - **Personnalisation** : Cr√©ez vos propres "Types de Prestations / Chambres" pour que les formulaires correspondent √† votre m√©tier.
    - **Permissions Employ√©s** : Activez ou d√©sactivez l'acc√®s √† certains modules (Jeux, Investissements) pour vos employ√©s.
    - **Manuel d'Utilisation** : Acc√©dez √† ce guide directement depuis l'application.

---

## üîå Architecture de Communication avec l'Application Ambassadeur (ABT)

Cette section d√©taille le fonctionnement technique de la communication entre **TTR Gestion** et **TTR Ambassadeur (ABT)** pour le syst√®me de parrainage.

### Le Probl√®me : S√©curit√© et CORS entre Domaines
Lorsque l'utilisateur entre un code promo dans le navigateur sur TTR Gestion, le navigateur doit appeler l'API de ABT pour valider ce code. Cependant, pour des raisons de s√©curit√©, les navigateurs bloquent par d√©faut les appels entre deux domaines diff√©rents (ex: `ttrgestion.site` appelant `abt.ttrgestion.site`). C'est le principe du **CORS (Cross-Origin Resource Sharing)**.

### La Solution : Le Proxy Externe (via Cloudflare Workers)
Pour r√©soudre ce probl√®me de mani√®re s√©curis√©e et stable, la communication passe par un **proxy externe** (un relais), h√©berg√© sur une infrastructure serverless comme Cloudflare Workers. Cette m√©thode est pr√©f√©rable √† un proxy interne pour sa robustesse.

Voici le flux exact :
1.  **Navigateur TTR Gestion ‚Üí Proxy Externe (Cloudflare)**
    - Le code client de TTR Gestion (dans `src/lib/firebase/database.ts`) appelle l'URL publique du proxy externe (ex: `https://mon-proxy.workers.dev`).
    - L'appel contient le `promoCode` et le `businessId` du nouveau compte.
    - La cl√© API secr√®te **n'est pas** incluse dans cet appel.

2.  **Proxy Externe (Cloudflare) ‚Üí Serveur ABT**
    - Le proxy externe re√ßoit la requ√™te.
    - Il ajoute deux √©l√©ments cruciaux avant de la transf√©rer au serveur ABT :
        - La **cl√© API secr√®te (`TTR_API_KEY`)**, stock√©e de mani√®re s√©curis√©e dans les secrets du Worker.
        - Les en-t√™tes **CORS** n√©cessaires (`Access-Control-Allow-Origin: *`) pour que le navigateur du client accepte la r√©ponse finale.
    - Le proxy transf√®re la requ√™te compl√®te au serveur de ABT. Cette communication de serveur √† serveur n'est pas soumise aux restrictions CORS du navigateur.

3.  **Serveur ABT**
    - Le serveur de ABT re√ßoit une requ√™te authentifi√©e et s√©curis√©e. Il n'a pas besoin de g√©rer des configurations CORS complexes, car il ne parle qu'au proxy externe.
    - Il valide le code et renvoie une r√©ponse JSON.

4.  **R√©ponse au Navigateur**
    - Le proxy externe re√ßoit la r√©ponse de ABT.
    - Il la renvoie au navigateur du client, en s'assurant que les en-t√™tes CORS sont corrects.
    - Le navigateur re√ßoit la r√©ponse comme s'il avait parl√© √† un serveur public compatible CORS.

### Variables d'Environnement Requises (fichier `.env.local` de TTR Gestion)
- `NEXT_PUBLIC_CLOUDFLARE_PROXY_URL`: L'URL compl√®te et publique du proxy externe d√©ploy√© (ex: `https://ttr-proxy.emapms.workers.dev/`). Le pr√©fixe `NEXT_PUBLIC_` est n√©cessaire car l'URL est utilis√©e par le code c√¥t√© navigateur.

---

Merci d'utiliser TTR Gestion. Nous nous engageons √† am√©liorer continuellement l'application pour soutenir votre succ√®s.
